{"version":3,"sources":["../../src/utils/BufferToChunks.js"],"names":["DivideToChunks","chunkSize","chunk","enc","cb","Buffer","isBuffer","Error","chunkLength","byteLength","partsCount","Math","ceil","i","startPos","endPos","push","slice"],"mappings":";;AAEA,gC;;AAEMA,c;;;AAGF,8BAA0C,KAA9BC,SAA8B,uEAAV,OAAO,CAAG;;AAEtC,cAAKA,SAAL,GAAiBA,SAAjB,CAFsC;AAGzC,K;;AAEUC,a,EAAeC,G,EAAaC,E,EAAc;;AAEjD,gBAAI,CAACC,OAAOC,QAAP,CAAgBJ,KAAhB,CAAL;AACI,kBAAM,IAAIK,KAAJ,CAAU,qBAAV,CAAN;;AAEJ,gBAAMC,cAAcH,OAAOI,UAAP,CAAkBP,KAAlB,CAApB;;AAEA,gBAAIM,cAAc,KAAKP,SAAvB,EAAkC;AAC9B,oBAAMS,aAAaC,KAAKC,IAAL,CAAUJ,cAAc,KAAKP,SAA7B,CAAnB;;AAEA,qBAAK,IAAIY,IAAI,CAAb,EAAgBA,IAAIH,UAApB,EAAgCG,GAAhC,EAAqC;AACjC,wBAAMC,WAAWD,IAAI,KAAKZ,SAA1B;AACA,wBAAMc,SAASD,WAAW,KAAKb,SAAhB,GAA4BO,WAA5B;AACTA,+BADS;AAETM,+BAAW,KAAKb,SAFtB;;AAIA,yBAAKe,IAAL,CAAUd,MAAMe,KAAN,CAAYH,QAAZ,EAAsBC,MAAtB,CAAV;AACH;AACJ,aAXD,MAWO;AACH,qBAAKC,IAAL,CAAUd,KAAV;AACH;;AAEDE;AACH,S;;;AAGUJ,c","file":"BufferToChunks.js","sourcesContent":["// @flow\n\nimport {Transform} from 'stream'\n\nclass DivideToChunks extends Transform {\n    chunkSize: number;\n\n    constructor(chunkSize: number = 1024 * 3) {        \n        super()\n        this.chunkSize = chunkSize\n    }\n\n    _transform(chunk: Object, enc: string, cb: Function) {\n\n        if (!Buffer.isBuffer(chunk))\n            throw new Error('Chunk is not Buffer')\n        \n        const chunkLength = Buffer.byteLength(chunk)\n        \n        if (chunkLength > this.chunkSize) {\n            const partsCount = Math.ceil(chunkLength / this.chunkSize)\n\n            for (let i = 0; i < partsCount; i++) {\n                const startPos = i * this.chunkSize\n                const endPos = startPos + this.chunkSize > chunkLength \n                    ? chunkLength \n                    : startPos + this.chunkSize \n                \n                this.push(chunk.slice(startPos, endPos))\n            }            \n        } else {\n            this.push(chunk)    \n        }\n\n        cb()\n    }\n}\n\nexport default DivideToChunks\n"]}