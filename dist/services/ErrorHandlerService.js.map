{"version":3,"sources":["../../src/services/ErrorHandlerService.js"],"names":["esClient","err","req","res","next","console","error","message","Error","stack","String","JSON","stringify","indexLogItem","created_datetime","getCurrentDateTime","source_id","type","headersSent","status","json"],"mappings":"2EAAA;AACA,uD;;AAEe,UAACA,QAAD,UAAc,UAACC,GAAD,EAAMC,GAAN,EAAWC,GAAX,EAAgBC,IAAhB,EAAyB;AAClDC,gBAAQC,KAAR,CAAcL,GAAd;;AAEA,YAAMM,UAAWN,eAAeO,KAAhB;AACPP,YAAIM,OADG,WACUN,IAAIQ,KADd;AAET,eAAOR,GAAP,KAAe,QAAf,IAA2BA,eAAeS,MAA3C,GAAqDT,GAArD,GAA2DU,KAAKC,SAAL,CAAeX,GAAf,CAFjE;;AAIA,uBAAQY,YAAR,CAAqBb,QAArB,EAA+B;AAC3Bc,8BAAkB,uBAAgBC,kBAAhB,EADS;AAE3BC,uBAAW,QAFgB;AAG3BC,kBAAM,OAHqB;AAI3BV,qBAASA,OAJkB,EAA/B;;;AAOA,YAAIJ,IAAIe,WAAR,EAAqB;AACjB,mBAAOd,KAAKH,GAAL,CAAP;AACH;;AAEDE,YAAIgB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,4BAAkBb,OAAlB,CAArB;AACH,KAnBc,E","file":"ErrorHandlerService.js","sourcesContent":["import { EsProxy, DateTimeService } from './index'\nimport ErrorResponse from '../utils/ErrorResponse'\n\nexport default (esClient) => (err, req, res, next) => {\n    console.error(err)\n\n    const message = (err instanceof Error) \n        ? `${err.message}\\n ${err.stack}`\n        : (typeof err === 'string' || err instanceof String) ? err : JSON.stringify(err)    \n\n    EsProxy.indexLogItem(esClient, {\n        created_datetime: DateTimeService.getCurrentDateTime(),\n        source_id: 'webapi',\n        type: 'error',\n        message: message\n    })\n    \n    if (res.headersSent) {\n        return next(err)\n    }\n\n    res.status(500).json(new ErrorResponse(message))\n} "]}